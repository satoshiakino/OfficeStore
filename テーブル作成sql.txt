//商品マスタ
create table prdct_mst
( prdct_id serial PRIMARY KEY,
  jan VARCHAR(20),
  cat_cd VARCHAR(10),
  prdct_nm VARCHAR(100),
  cost integer,
  price int,
  cost_rate DOUBLE PRECISION,
  latest boolean default true
  )

//仕入テーブル
CREATE TABLE arrival
( arrvl_id SERIAL PRIMARY KEY,
  trade_date TIMESTAMP,
  cat_cd VARCHAR(10),
  prdct_id INTEGER,
  trade_num INTEGER,
  checked boolean DEFAULT false,
  count boolean default false
  )

//売上テーブル
CREATE TABLE sales
( sales_id SERIAL PRIMARY KEY,
  cat_cd character(10) NOT NULL,
  prdct_id INTEGER  NOT NULL,
  trade_num INTEGER,
  trade_date TIMESTAMP,
  checked boolean default false,
  count boolean default false
  )

//カテゴリテーブル
CREATE TABLE category
( cat_id SERIAL PRIMARY KEY,
  cat_cd VARCHAR(4),
  cat_nm VARCHAR(30))

//精算書テーブル
create table settlement (
 set_id serial primary key,
 total_cost integer,
 total_sales integer,
 profit_loss integer,
 total_calc_cash integer,
 excess_deficiency integer,
 total_cash integer,
 settle_date timestamp,
 latest boolean default true
)
 
//仕入アーカイブ
create table arrival_archives (
 arrvl_id integer primary key,
 cat_cd varchar(4),
 cat_nm varchar(30),
 jan varchar(20),
 prdct_nm varchar(100),
 cost integer,
 trade_num integer,
 trade_date timestamp
)

//売上アーカイブ
create table sales_archives (
 sales_id integer primary key,
 cat_cd varchar(4),
 cat_name varchar(30),
 jan varchar(20),
 prdct_nm varchar(100),
 price integer,
 trade_num integer,
 trade_date timestamp
 )

//棚卸結果テーブル
create table inventory_count (
 invntry_id serial primary key,
 prdct_id integer,
 invntry_num integer,
 count_num integer,
 count_date timestamp,
 result_no integer
)

//カレンダーマスタ
create table calendar_mst (
 "DATE" char(8),
 days date primary key
)

 INSERT INTO calendar_mst
SELECT
--日付文字列
  TO_CHAR(date ('21000331') - CAST( CAST (DATES AS varchar) || ' days' as interval ), 'YYYYMMDD' ) AS "date",
--日付date型
  (date ('21000331') - CAST( CAST (DATES AS varchar) || ' days' as interval ) )::date AS days
FROM
--カレンダーの動的生成
  GENERATE_SERIES(0, (date ('21000331') - date ('20000401'))::integer) AS "month"(DATES)

alter table calendar_mst add column "day" int

update calendar_mst set "day" = EXTRACT(DAY FROM days)
